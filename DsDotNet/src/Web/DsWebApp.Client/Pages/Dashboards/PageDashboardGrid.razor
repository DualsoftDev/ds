@* PageDashboardGrid *@
<h3>PageDashboardGrid</h3>

@page "/dashboards/grid"

@using System.Collections.ObjectModel
@using DsWebApp.Client.Pages.Hmis
@using static Engine.Core.InfoPackageModule

@inherits CompHmiLoader
@implements IAsyncDisposable

@attribute [Authorize(Roles = "Administrator")]



@code {
    bool _loading = true;
    protected HubConnectionManager _hubConnectionManager;
    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        HubConnection hubConnection = await NavigationManager.ToAbsoluteUri("/hub/info").StartHubAsync();
        _hubConnectionManager = new HubConnectionManager(hubConnection, registerHubConnection);
        Console.WriteLine($"Hub initialized on PageDashboardGrid.razor");


        IDisposable registerHubConnection(HubConnection hubConnection)
        {
            return hubConnection.On<InfoSystem>(SK.S2CNInfoChanged, (InfoSystem info) =>
            {
                Console.WriteLine($"Info change notification received with {info.Name}.");
                ToastService.ShowInfo($"Info change: {info.Name}.");
                //ClientGlobal.TagChangedSubject.OnNext(info);
            });
        }

        _loading = false;
    }
    public async ValueTask DisposeAsync()
    {
        await _hubConnectionManager.DisposeAsync();
    }



}
